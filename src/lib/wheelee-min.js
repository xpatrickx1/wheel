(async()=>{try{let e;if(window.wheeleeKey)e=window.wheeleeKey;else{if(!window.wheeleeSlug)return void console.error("wheeleeKey or wheeleeSlug required");{const n="https://ptulighepuqttsocdovp.supabase.co",t=await fetch(`${n}/functions/v1/get-widget-id/${window.wheeleeSlug}`);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const o=await t.json();if(!o.id)throw new Error("Widget ID not found");e=o.id}}const n="https://ptulighepuqttsocdovp.supabase.co";fetch(`${n}/functions/v1/get-widget/${e}`).then((e=>{if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);return e.json()})).then((t=>{if(!t||t.error)throw new Error(t.error||"Widget not found");let o=document.getElementById("wheelee-container");o||(o=document.createElement("div"),o.id="wheelee-container",document.body.appendChild(o)),function(t){let o=!1;function a(e){const n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:{r:0,g:0,b:0}}function r(e,n,t){return"#"+[e,n,t].map((e=>e.toString(16).padStart(2,"0"))).join("")}function i(e,n){const t=a(e),o=1-n/100;return r(Math.round(t.r*o),Math.round(t.g*o),Math.round(t.b*o))}const{prizes:s,color:l,buttonText:d,collectData:c}=t,p=l||"#eb112a",h=i(p,20),m=documet.body;if(!m)return;const u=document.querySelector(".widget-wheel-wrap");u&&(console.warn("Колесо вже існує на сторінці. Видаляю старе..."),u.remove());const f=document.createElement("div");f.className="widget-wheel-wrap",m.appendChild(f);const w=document.createElement("div");w.className="wheel-form";const g=document.createElement("canvas");g.width=550,g.height=550,f.appendChild(g),f.appendChild(w);const x=g.getContext("2d");if(!x)return;const b=g.width/2,v=b-10,y=2*Math.PI/s.length;if(!o){const e=document.createElement("style");e.id="widget-wheel-styles",e.textContent="\n                .widget-wheel-wrap {\n                    display: flex;\n                    align-items: center;\n                    gap: 20px;\n                }\n                .widget-wheel-spin-btn {\n                    display: block;\n                    padding: 15px 30px;\n                    color: white;\n                    border: none;\n                    white-space: nowrap;\n                    font-size: 18px;\n                    cursor: pointer;\n                    transition: background 0.3s;\n                    position: relative;\n                    z-index: 200;\n                    margin-top: 1rem;\n                    border-radius: 0.375rem;\n                    color: white;\n                    font-weight: bold;\n                    padding: 1rem 2rem;\n                }\n    \n                .widget-wheel-spin-btn:hover {\n                    transform: scale(1.05);\n                }\n    \n                .widget-wheel-spin-btn:disabled {\n                    background: #ccc;\n                    cursor: not-allowed;\n                    transform: none;\n                }\n    \n                .checkbox-box {\n                    width: 26px;            \n                    height: 26px;           \n                    min-width: 26px;        \n                    border-radius: 5px;     \n                    margin-right: 0.5rem;   \n                    border: 1px solid rgba(255,255,255,.2);\n                }\n    \n                .form-wrap {\n                    width: 100%;\n                    display: flex;\n                    flex-direction: column;\n                    align-items: flex-start;\n                    max-width: 400px;\n                }\n    \n                .form-title {\n                    font-size: 24px;\n                    font-weight: bold;\n                }\n    \n                .form-subtitle {\n                    font-size: 18px;\n                    margin-top: 4px;\n                    margin-top: 20px;\n                }\n    \n                .form {\n                    width: 100%;\n                    display: flex;\n                    flex-direction: column;\n                    align-items: flex-start;\n                    margin-top: 20px;\n                }\n    \n                .input-wrap {\n                    width: 100%;\n                    display: flex;\n                    flex-direction: column;\n                    align-items: flex-start;\n                }\n    \n                .form-input {\n                    width: 100%;\n                    max-width: 100%;\n                    border: 1px solid rgba(255, 255, 255, 0.1);\n                    outline: none;\n                    background-color: transparent;\n                    color: white;\n                    height: 60px;\n                    border-radius: 10px;\n                    padding-left: 60px;\n                }\n    \n                .checkbox-wrap {\n                    width: 100%;\n                    display: flex;\n                    align-items: flex-start;\n                     margin-top: 20px;\n                }\n    \n                .form-label {\n                    position: relative;\n                    cursor: pointer;\n                    display: inline-flex;\n                    align-items: center;\n                }\n    \n               .checked {\n                    background-repeat: no-repeat;\n                    background-position: center;\n                    background-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+IDxwYXRoIGQ9Ik0xMS40IDVMMTAgMy42bC00IDQtMi0yTDIuNiA3IDYgMTAuNHoiIGZpbGw9IiNGRkYiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPjwvc3ZnPg==);\n                }\n    \n                .policy-text {\n                    font-size: 12px;\n                    line-height: 16px;\n                }\n    \n                .widget-prize-title {\n                    font-size: 46px;\n                    line-height: 50px;\n                    color: white;\n                    font-weight: bold;\n                }\n    \n                .widget-prize-text {\n                    font-size: 18px;\n                    line-height: 22px;\n                    margin-top: 20px;\n                    color: white;\n                }\n    \n                .checkbox-box.error {\n                  animation: shake 0.12s ease-in-out 0s 2;\n                  box-shadow: 0 0 0.5em #ff4949;\n                  border: 1px solid #ff4949;\n                  transition: opacity 0.4s ease, box-shadow 0.4s ease, border 0.4s ease;\n                  opacity: 1;\n                }\n    \n                input.error {\n                  animation: shake 0.12s ease-in-out 0s 2;\n                  box-shadow: 0 0 0.5em #ff4949;\n                  border: 1px solid #ff4949;\n                  transition: opacity 0.4s ease, box-shadow 0.4s ease, border 0.4s ease;\n                  opacity: 1;\n                }\n    \n                @keyframes shake {\n                  0% { transform: translateX(0); }\n                  25% { transform: translateX(4px); }\n                  75% { transform: translateX(-4px); }\n                  100% { transform: translateX(0); }\n                }\n            ",document.head.appendChild(e),o=!0}let C=0,E=!1,k=null,M="",I=!1,T=!1;function N(){x&&(x.clearRect(0,0,g.width,g.height),s.forEach(((e,n)=>{const t=n*y+C,o=t+y;x.shadowColor="rgba(0,0,0,0.2)",x.shadowBlur=8,x.shadowOffsetX=0,x.shadowOffsetY=2,x.save(),x.shadowColor="transparent",x.beginPath(),x.moveTo(b,b),x.arc(b,b,v,t,o),x.fillStyle=n%2==0?p:h,x.fill(),x.save(),x.translate(b,b),x.rotate(t+y/2),x.textAlign="center",x.textBaseline="middle";const a=v/2;x.fillStyle="#000",x.font="16px Arial",x.fillText(e.text,a+40,0),x.restore()})),x.save(),x.shadowColor="rgba(0,0,0,0.2)",x.shadowBlur=8,x.shadowOffsetX=0,x.shadowOffsetY=2,x.beginPath(),x.arc(b,b,60,0,2*Math.PI),x.fillStyle="#fff",x.fill(),x.restore(),x.shadowColor="rgba(0, 0, 0, 0.2)",x.shadowBlur=3,x.shadowOffsetX=-3,x.shadowOffsetY=3,x.fillStyle="#fff",x.beginPath(),x.moveTo(b+v+7,b-15),x.lineTo(b+v+7,b+15),x.lineTo(b+v-35,b),x.closePath(),x.fill())}function P(){if(E)return;E=!0;const t=Math.floor(Math.random()*s.length),o=(Math.random()-.5)*y*.8,a=2*Math.PI*5+(t*y+y/2)+o,r=5e3,i=performance.now(),l=C;function d(e,n=.4){return e<n?Math.pow(e/n,2):1-Math.pow(1-e,3)}function c(t){const o=t-i,p=Math.min(o/r,1),h=d(p);if(C=l+h*a,N(),p<1)requestAnimationFrame(c);else{E=!1;const t=(C%(2*Math.PI)+2*Math.PI)%(2*Math.PI),o=Math.floor((2*Math.PI-t)%(2*Math.PI)/y);k=s[o].text;try{fetch(`${n}/save-result`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({widget_id:e,contact:contact,prize:prize})})}catch(e){console.error("save result err",e)}z()}}requestAnimationFrame(c)}function z(){if(w.innerHTML="",k){const o=document.createElement("div"),a=document.createElement("div");a.className="widget-prize-title",a.textContent=k;const r=document.createElement("div");r.className="widget-prize-text",r.textContent=t.successMessage,o.appendChild(a),o.appendChild(r),f.appendChild(o)}else{const i=document.createElement("div");if(i.className="form-wrap",t.title){const y=document.createElement("div");y.className="form-title",y.textContent=t.title,i.appendChild(y)}if(t.subtitle){const C=document.createElement("p");C.className="form-subtitle",C.textContent=t.subtitle,i.appendChild(C)}const s=document.createElement("form");s.className="form",s.addEventListener("submit",(e=>e.preventDefault()));const l=document.createElement("div");l.className="input-wrap";const p=document.createElement("input");function e(){if("email"===c){console.log("email");T=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p.value.trim())}else if("tel"===c){console.log("tel");T=/^\+?[0-9]{7,15}$/.test(p.value.trim())}return T||(p.classList.add("error"),setTimeout((()=>{p.classList.remove("error")}),1e3)),T}function n(){return I||(x.classList.add("error"),setTimeout((()=>{x.classList.remove("error")}),1e3)),I}p.value=M,p.type="email"===c?"email":"tel",p.placeholder="email"===c?"Enter your email":"Enter your phone",p.className="form-input",p.addEventListener("input",(e=>M=e.target.value)),l.appendChild(p),p.addEventListener("blur",e);const h=document.createElement("div");h.className="checkbox-wrap";const m=document.createElement("div"),u=document.createElement("label");u.className="form-label";const g=document.createElement("input");g.type="checkbox",g.className="sr-only peer",g.addEventListener("change",(()=>{I=g.checked,I&&x.classList.add("checked"),z()}));const x=document.createElement("div");x.className="checkbox-box",I&&x.classList.add("checked"),g.checked=I,u.appendChild(g),u.appendChild(x),m.appendChild(u);const b=document.createElement("div");b.className="policy-text",b.innerHTML=`Я даю своё <a href="#" class="" target="_blank">Cогласие</a> на обработку персональных данных и подтверждаю ознакомление с <a href="${t.privacyUrl}" class="" target="_blank">Политикой</a> обработки персональных данных`,h.appendChild(m),h.appendChild(b);const v=document.createElement("button");v.id="spin_button",v.textContent=d,v.className="widget-wheel-spin-btn",v.style.backgroundColor=t.color,v.addEventListener("click",(()=>{if(!I||!e())return n(),void e();P()})),s.appendChild(l),s.appendChild(h),s.appendChild(v),i.appendChild(s),w.appendChild(i)}}z(),N()}({...t.settings,container:o})})).catch((e=>console.error("Widget load error:",e)))}catch(e){console.error("widget init err",e)}})();